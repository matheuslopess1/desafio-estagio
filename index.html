<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listagem de Pessoas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css" />
</head>
<body>
    <div class="section">
        <div class="container">
            <h1 class="title">Listagem de Pessoas</h1>
            <h2 class="subtitle">Desafio para o Estágio na Moovery.</h2>
            <div class="pb-5">
                <div class="field">
                    <div class="field is-grouped">
                        <div class="control">
                            <div class="select">
                                <select id="people-amount">
                                    <option value="">Nº de Pessoas</option>
                                    <option>10</option>
                                    <option>25</option>
                                    <option>50</option>
                                    <option>100</option>
                                </select>
                            </div>
                        </div>
                        <div class="control">
                            <button class="button is-primary" onclick="getRandomUsers()">
                                <span class="icon is-small">
                                    <i class="fas fa-sync"></i>
                                </span>
                                <span>Atualizar</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <table class="table is-fullwidth">
                <thead>
                    <tr>
                        <th>Foto</th>
                        <th>Nome</th>
                        <th>Sobrenome</th>
                        <th>Idade</th>
                        <th>Cidade</th>
                    </tr>
                </thead>
                <tbody>
                    <tbody id="table-body">
                    </tbody>
                </tbody>
            </table>
        </div>
    </div>
    <script defer src="https://use.fontawesome.com/releases/v5.14.0/js/all.js"></script>
    <script>
        const getRandomUsers = () => {
            const peopleAmountSelectElement = document.getElementById('people-amount')
            const peopleAmountSelectedOptionIndex = peopleAmountSelectElement.selectedIndex
            const peopleAmountSelectedOption = peopleAmountSelectElement[peopleAmountSelectedOptionIndex]
            const peopleAmount = peopleAmountSelectedOption.value || '10'

            fetch(`https://api.randomuser.me/?results=${peopleAmount}`)
            .then(response =>
                response.json().then(body => {
                    peopleAmountSelectElement.selectedIndex = 0
                    const tableBodyElement = document.getElementById('table-body')
                    while (tableBodyElement.childElementCount > 0)
                        tableBodyElement.removeChild(tableBodyElement.lastElementChild)
                    for (const user of body.results) {
                        const tableRowElement = document.createElement('tr')
                        tableBodyElement.append(tableRowElement)
                        
                        const photoTableDataElement = document.createElement('td')
                        tableRowElement.append(photoTableDataElement)

                        const imageElement = document.createElement('img')
                        photoTableDataElement.append(imageElement)
                        imageElement.setAttribute('src', user.picture.thumbnail)
                        
                        const { name: { first, last }, dob: { age }, location: { city } } = user

                        for (const data of [first, last, age, city]) {
                            const tableDataElement = document.createElement('td')
                            tableRowElement.append(tableDataElement)
                            tableDataElement.style.verticalAlign = 'middle'
                            const dataTextNode = document.createTextNode(data)
                            tableDataElement.append(dataTextNode)
                        }
                    }
                })
            )
            .catch(console.error)
        }

            getRandomUsers()
    </script>
</body>
</html>